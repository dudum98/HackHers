{"ast":null,"code":"import \"./chunk-7ELT755Q.mjs\";\n\n// src/authorization.ts\nvar TYPES_TO_OBJECTS = {\n  veryStrict: {\n    afterMinutes: 10,\n    level: \"multiFactor\"\n  },\n  strict: {\n    afterMinutes: 10,\n    level: \"secondFactor\"\n  },\n  moderate: {\n    afterMinutes: 60,\n    level: \"secondFactor\"\n  },\n  lax: {\n    afterMinutes: 1440,\n    level: \"secondFactor\"\n  }\n};\nvar ALLOWED_LEVELS = /* @__PURE__ */new Set([\"firstFactor\", \"secondFactor\", \"multiFactor\"]);\nvar ALLOWED_TYPES = /* @__PURE__ */new Set([\"veryStrict\", \"strict\", \"moderate\", \"lax\"]);\nvar isValidMaxAge = maxAge => typeof maxAge === \"number\" && maxAge > 0;\nvar isValidLevel = level => ALLOWED_LEVELS.has(level);\nvar isValidVerificationType = type => ALLOWED_TYPES.has(type);\nvar checkOrgAuthorization = (params, options) => {\n  const {\n    orgId,\n    orgRole,\n    orgPermissions\n  } = options;\n  if (!params.role && !params.permission) {\n    return null;\n  }\n  if (!orgId || !orgRole || !orgPermissions) {\n    return null;\n  }\n  if (params.permission) {\n    return orgPermissions.includes(params.permission);\n  }\n  if (params.role) {\n    return orgRole === params.role;\n  }\n  return null;\n};\nvar validateReverificationConfig = config => {\n  const convertConfigToObject = config2 => {\n    if (typeof config2 === \"string\") {\n      return TYPES_TO_OBJECTS[config2];\n    }\n    return config2;\n  };\n  if (typeof config === \"string\" && isValidVerificationType(config)) {\n    return convertConfigToObject.bind(null, config);\n  }\n  if (typeof config === \"object\" && isValidLevel(config.level) && isValidMaxAge(config.afterMinutes)) {\n    return convertConfigToObject.bind(null, config);\n  }\n  return false;\n};\nvar checkStepUpAuthorization = (params, {\n  __experimental_factorVerificationAge\n}) => {\n  if (!params.__experimental_reverification || !__experimental_factorVerificationAge) {\n    return null;\n  }\n  const isValidReverification = validateReverificationConfig(params.__experimental_reverification);\n  if (!isValidReverification) {\n    return null;\n  }\n  const {\n    level,\n    afterMinutes\n  } = isValidReverification();\n  const [factor1Age, factor2Age] = __experimental_factorVerificationAge;\n  const isValidFactor1 = factor1Age !== -1 ? afterMinutes > factor1Age : null;\n  const isValidFactor2 = factor2Age !== -1 ? afterMinutes > factor2Age : null;\n  switch (level) {\n    case \"firstFactor\":\n      return isValidFactor1;\n    case \"secondFactor\":\n      return factor2Age !== -1 ? isValidFactor2 : isValidFactor1;\n    case \"multiFactor\":\n      return factor2Age === -1 ? isValidFactor1 : isValidFactor1 && isValidFactor2;\n  }\n};\nvar createCheckAuthorization = options => {\n  return params => {\n    if (!options.userId) {\n      return false;\n    }\n    const orgAuthorization = checkOrgAuthorization(params, options);\n    const stepUpAuthorization = checkStepUpAuthorization(params, options);\n    if ([orgAuthorization, stepUpAuthorization].some(a => a === null)) {\n      return [orgAuthorization, stepUpAuthorization].some(a => a === true);\n    }\n    return [orgAuthorization, stepUpAuthorization].every(a => a === true);\n  };\n};\nexport { createCheckAuthorization };","map":{"version":3,"names":["TYPES_TO_OBJECTS","veryStrict","afterMinutes","level","strict","moderate","lax","ALLOWED_LEVELS","Set","ALLOWED_TYPES","isValidMaxAge","maxAge","isValidLevel","has","isValidVerificationType","type","checkOrgAuthorization","params","options","orgId","orgRole","orgPermissions","role","permission","includes","validateReverificationConfig","config","convertConfigToObject","config2","bind","checkStepUpAuthorization","__experimental_factorVerificationAge","__experimental_reverification","isValidReverification","factor1Age","factor2Age","isValidFactor1","isValidFactor2","createCheckAuthorization","userId","orgAuthorization","stepUpAuthorization","some","a","every"],"sources":["/Users/nethmeeperera/Desktop/my-app/node_modules/@clerk/shared/src/authorization.ts"],"sourcesContent":["import type {\n  __experimental_ReverificationConfig,\n  __experimental_SessionVerificationLevel,\n  __experimental_SessionVerificationTypes,\n  CheckAuthorizationWithCustomPermissions,\n  OrganizationCustomPermissionKey,\n  OrganizationCustomRoleKey,\n} from '@clerk/types';\n\ntype TypesToConfig = Record<\n  __experimental_SessionVerificationTypes,\n  Exclude<__experimental_ReverificationConfig, __experimental_SessionVerificationTypes>\n>;\ntype AuthorizationOptions = {\n  userId: string | null | undefined;\n  orgId: string | null | undefined;\n  orgRole: string | null | undefined;\n  orgPermissions: string[] | null | undefined;\n  __experimental_factorVerificationAge: [number, number] | null;\n};\n\ntype CheckOrgAuthorization = (\n  params: { role?: OrganizationCustomRoleKey; permission?: OrganizationCustomPermissionKey },\n  { orgId, orgRole, orgPermissions }: AuthorizationOptions,\n) => boolean | null;\n\ntype CheckStepUpAuthorization = (\n  params: {\n    __experimental_reverification?: __experimental_ReverificationConfig;\n  },\n  { __experimental_factorVerificationAge }: AuthorizationOptions,\n) => boolean | null;\n\nconst TYPES_TO_OBJECTS: TypesToConfig = {\n  veryStrict: {\n    afterMinutes: 10,\n    level: 'multiFactor',\n  },\n  strict: {\n    afterMinutes: 10,\n    level: 'secondFactor',\n  },\n  moderate: {\n    afterMinutes: 60,\n    level: 'secondFactor',\n  },\n  lax: {\n    afterMinutes: 1_440,\n    level: 'secondFactor',\n  },\n};\n\nconst ALLOWED_LEVELS = new Set<__experimental_SessionVerificationLevel>(['firstFactor', 'secondFactor', 'multiFactor']);\n\nconst ALLOWED_TYPES = new Set<__experimental_SessionVerificationTypes>(['veryStrict', 'strict', 'moderate', 'lax']);\n\n// Helper functions\nconst isValidMaxAge = (maxAge: any) => typeof maxAge === 'number' && maxAge > 0;\nconst isValidLevel = (level: any) => ALLOWED_LEVELS.has(level);\nconst isValidVerificationType = (type: any) => ALLOWED_TYPES.has(type);\n\n/**\n * Checks if a user has the required organization-level authorization.\n * Verifies if the user has the specified role or permission within their organization.\n * @returns null, if unable to determine due to missing data or unspecified role/permission.\n */\nconst checkOrgAuthorization: CheckOrgAuthorization = (params, options) => {\n  const { orgId, orgRole, orgPermissions } = options;\n  if (!params.role && !params.permission) {\n    return null;\n  }\n  if (!orgId || !orgRole || !orgPermissions) {\n    return null;\n  }\n\n  if (params.permission) {\n    return orgPermissions.includes(params.permission);\n  }\n  if (params.role) {\n    return orgRole === params.role;\n  }\n  return null;\n};\n\nconst validateReverificationConfig = (config: __experimental_ReverificationConfig | undefined) => {\n  const convertConfigToObject = (config: __experimental_ReverificationConfig) => {\n    if (typeof config === 'string') {\n      return TYPES_TO_OBJECTS[config];\n    }\n    return config;\n  };\n\n  if (typeof config === 'string' && isValidVerificationType(config)) {\n    return convertConfigToObject.bind(null, config);\n  }\n\n  if (typeof config === 'object' && isValidLevel(config.level) && isValidMaxAge(config.afterMinutes)) {\n    return convertConfigToObject.bind(null, config);\n  }\n\n  return false;\n};\n\n/**\n * Evaluates if the user meets step-up authentication requirements.\n * Compares the user's factor verification ages against the specified maxAge.\n * Handles different verification levels (first factor, second factor, multi-factor).\n * @returns null, if requirements or verification data are missing.\n */\nconst checkStepUpAuthorization: CheckStepUpAuthorization = (params, { __experimental_factorVerificationAge }) => {\n  if (!params.__experimental_reverification || !__experimental_factorVerificationAge) {\n    return null;\n  }\n\n  const isValidReverification = validateReverificationConfig(params.__experimental_reverification);\n  if (!isValidReverification) {\n    return null;\n  }\n\n  const { level, afterMinutes } = isValidReverification();\n  const [factor1Age, factor2Age] = __experimental_factorVerificationAge;\n\n  // -1 indicates the factor group (1fa,2fa) is not enabled\n  // -1 for 1fa is not a valid scenario, but we need to make sure we handle it properly\n  const isValidFactor1 = factor1Age !== -1 ? afterMinutes > factor1Age : null;\n  const isValidFactor2 = factor2Age !== -1 ? afterMinutes > factor2Age : null;\n\n  switch (level) {\n    case 'firstFactor':\n      return isValidFactor1;\n    case 'secondFactor':\n      return factor2Age !== -1 ? isValidFactor2 : isValidFactor1;\n    case 'multiFactor':\n      return factor2Age === -1 ? isValidFactor1 : isValidFactor1 && isValidFactor2;\n  }\n};\n\n/**\n * Creates a function for comprehensive user authorization checks.\n * Combines organization-level and step-up authentication checks.\n * The returned function authorizes if both checks pass, or if at least one passes\n * when the other is indeterminate. Fails if userId is missing.\n */\nexport const createCheckAuthorization = (options: AuthorizationOptions): CheckAuthorizationWithCustomPermissions => {\n  return (params): boolean => {\n    if (!options.userId) {\n      return false;\n    }\n\n    const orgAuthorization = checkOrgAuthorization(params, options);\n    const stepUpAuthorization = checkStepUpAuthorization(params, options);\n\n    if ([orgAuthorization, stepUpAuthorization].some(a => a === null)) {\n      return [orgAuthorization, stepUpAuthorization].some(a => a === true);\n    }\n\n    return [orgAuthorization, stepUpAuthorization].every(a => a === true);\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}